---
const plans = [
  {
    name: "Basic Paket",
    products: [
      {
        name: "Taskie qurilma",
        price: 1_700_000,
        count: "1 dona"
      },
      {
        name: "Tizim va qurilma o'rnatish, sozlash",
        price: 1_800_000,
        count: "1 marta"
      },
      {
        name: "Abonent to'lovi (1 - 10)",
        price: 200_000,
        count: "1 oylik"
      }
    ],
    totalPrice: 3_700_000
  },
  {
    name: "Standard Paket",
    products: [
      {
        name: "Taskie qurilma",
        price: 1_700_000,
        count: "1 dona"
      },
      {
        name: "Tizim va qurilma o'rnatish, sozlash",
        price: 1_800_000,
        count: "1 marta"
      },
      {
        name: "Abonent to'lovi (11 - 20)",
        price: 380_000,
        count: "1 oylik"
      },
      {
        name: "Qo'shimcha qurilma o'rnatish va sozlash",
        price: 300_000,
        count: "1 dona"
      }
    ],
    totalPrice: 4_180_000
  },
  {
    name: "Premium Paket",
    products: [
      {
        name: "Taskie qurilma",
        price: 1_700_000,
        count: "1 dona"
      },
      {
        name: "Tizim va qurilma o'rnatish, sozlash",
        price: 1_800_000,
        count: "1 marta"
      },
      {
        name: "Abonent to'lovi (31 - 50)",
        price: 750_000,
        count: "1 oylik"
      },
      {
        name: "Taskie da GPS moduli",
        price: 5_000,
        count: "10 dona"
      }
    ],
    totalPrice: 4_300_000
  },
  {
    name: "Enterprise Paket",
    products: [],
    totalPrice: 0
  }
];
---

<section id="pricing" class="py-8">
  <h2 class="text-center text-3xl md:text-6xl mt-8 mb-8 md:mb-16 font-semibold">Tariflar</h2>
  <div class="container">
    <div class="flex flex-col md:flex-row gap-8">
      {
        plans.map(plan => {
          return (
            <div
              data-gsap="pricing-item"
              class="w-full shadow-md py-8 px-4 flex flex-col gap-4 items-center rounded-md border border-transparent hover:border-primary">
              <h3 class="text-3xl font-bold">{plan.name}</h3>
              <p class:list={["text-center", "opacity-50", {
                "hidden": plan.totalPrice !== 0
              }]}>
                {
                  plan.totalPrice === 0 && "Faqat kerakli hizmatlarni tanlash imkoniyati"
                }
              </p>
              <ul class="w-full h-full flex flex-col gap-2">
                {
                  plan.products.map(product => {
                    return (
                      <li class="flex items-center gap-2 text-sm">
                        <span class="">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                             stroke="currentColor" class="size-5 text-primary">
                          <path stroke-linecap="round" stroke-linejoin="round"
                                d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                        </svg>
                        </span>
                        <span>
                        {product.name} {product.count}
                        </span>
                      </li>
                    );
                  })
                }
              </ul>
              <h4 class="text-xl font-bold text-primary">{plan.totalPrice > 0 && new Intl.NumberFormat("uz", {
                currency: "UZS",
                style: "currency",
                minimumFractionDigits: 0
              }).format(plan.totalPrice)}
              </h4>
              <button class="bg-primary w-full py-4 text-lg font-bold text-white rounded-md">Sotib olish</button>
            </div>
          );
        })
      }
    </div>
  </div>
</section>

<script>
  import { gsap, ScrollTrigger } from "../../utils/gsap";

  const pricing = document.getElementById("pricing");
  const items = document.querySelectorAll("[data-gsap='pricing-item']");
  const title = document.querySelector("#pricing>h2");
  const timeline = gsap.timeline({
    defaults: {
      opacity: 0,
      scale: 0.8,
      ease: "power2.out",
      duration: 1
    }
  });
  timeline.from(title, {
    opacity: 0
  });
  items.forEach((item, index) => {
    timeline.from(item, {
      y: 20 * index, // Adding some vertical offset for each item
      rotation: index % 2 === 0 ? 5 : -5 // Alternate rotation for each item
    }, `-=${index * 0.3}`); // Staggering the start time of each animation
  });

  ScrollTrigger.create({
    trigger: pricing,
    animation: timeline,
    start: "top 50%", // Start animation when the trigger is 80% from the top of the viewport
    end: "bottom 90%", // End animation when the trigger is 20% from the bottom of the viewport
    scrub: 2 // Smooth scrubbing
  });
</script>